<template>
    <div class="user_pay">
        <div class="quick_content_box3 box_h">
            <div class="quick_user_opration">
                <div class="quick_user_inputbox box_h">
                    <!-- 投注倍数 -->
                    <div class='quick_user_input1 box_h'>
                        <span>已选&nbsp;<strong v-text="betnum" style="color: #ff680a"/>&nbsp;注</span>
                        <div class="comput_flod">
                            <button class="quick_reduce" @click="quickReduce">-</button>
                            <div @mouseleave="hideMagni" style="z-index: 1">
                                <input type="text" v-model="Magnification" @click="showArrow"/>
                                <div class="arrow_bottom_box" v-if="arrowBot">
                                  <span :data-value="item" v-for="(item,index) in MagniAry" :key="index"
                                        @click="selectMagni">{{item}}</span>
                                </div>
                            </div>
                            <button class="quick_add" @click="quickAdd">+</button>
                        </div>
                        <span>&ensp;倍</span>
                    </div>
                    <!-- 模式 -->
                    <div class="quick_user_input2 box_h">
                        <div :class="[selectId == item.Id?'selected':'']" v-for="(item,index) in mounttype" @click="SelectMount(item)" :key="index">
                            {{item.Name}}
                        </div>
                        <span>&emsp;共&ensp;<strong style="color:#FE6D60;" v-text="betmoney.toFixed(3)"/>&ensp;元</span>
                    </div>
                </div>
            </div>
            <div class="user_btn_box">
                <a class="add_num" href="javascript:void(0)" @click="changeNum">添加号码</a>
                <a href="javascript:void(0)" class="direct_bet" @click="Dirbet">一键投注</a>
            </div>
        </div>
    </div>
</template>
<script>
  export default {
    props: {
      betnum: {
        type: Number,
        required: true
      },
      betmoney: {
        type: Number,
        required: true
      },
      userselect: {
        type: Array,
        required: true
      },
      mounttype: {
        type: Array,
        required: true
      },
      mult: {
        type: Number,
        required: true
      }
    },
    data() {
      return {
        mountName: '2元',//选择的下注金额单位
        arrowBot: false, //下拉框状态
        Magnification: this.mult, //倍率
        MagniAry: ["1", "5", "10", "15", "20"], //选择倍数
        selectId:0,//默认选中模式
      }
    },
    created() {
      window.eventBus.$on('addNum2Allin', () => {
        this.allBet()
      })
      this.$nextTick(()=>{
        this.selectId = this.mounttype[0].Id
        this.$emit("typeset", this.mounttype[0].Name)//默认选中两元
      })
    },
    methods: {
      // 显示下拉框
      showArrow() {
        this.arrowBot = true
      },
      hideMagni() {
        this.arrowBot = false
      },
      //选择倍率
      selectMagni(e) {
        this.Magnification = parseInt(e.target.dataset.value)
        this.arrowBot = false
        this.$emit("gamemultiply", this.Magnification)
      },
      //奖金调节
      adjustMent(e) {
        let that = this
        let value = e.target.value
        this.$emit("bonus", value)
      },
      //选择模式
      SelectMount(val) {
        // this.$emit("typeset", this.mountName)
        this.$emit("typeset", val.Name)
        this.selectId = val.Id
        window.sessionStorage.setItem('userPaySelectId',this.selectId)
        window.sessionStorage.setItem('thisId',this.$route.query.id)
      },
      // 增加倍率
      quickAdd() {
        let that = this
        let num = that.mult
        num = parseInt(num) + 1
        that.Magnification = num
        this.$emit("gamemultiply", that.Magnification)
      },
      //减少倍率
      quickReduce() {
        let that = this
        let num = that.mult
        if (num > 1) {
          num = num - 1
          that.Magnification = num
          this.$emit("gamemultiply", that.Magnification)
        } else if (num == 0) {
          that.Magnification = ""
          this.$emit("gamemultiply", that.Magnification)
        }
      },
      // 一键投注
      Dirbet() {
        this.$emit("dirbet")
        window.eventBus.$emit('newGameListState');
      },
      // 一键梭哈
      allBet() {
        this.$emit("allin")
      },
      // 添加号码
      changeNum() {
        window.eventBus.$emit('newVersionAddNum');
        window.eventBus.$emit('newGameListState');
      },
    },
    watch: {
      mult: function () {
        this.Magnification = this.mult
      },
      Magnification(val){
        this.arrowBot = false
        let num = 0
        if (val == '' || val == 'NaN') {
          this.Magnification = ''
          num = 0
        } else {
          this.Magnification = parseInt(val)
          num = parseInt(this.Magnification)
        }
        this.$emit("gamemultiply", num)
      },
      mounttype(){
        this.$emit("typeset", this.mounttype[0].Name)//默认选中两元
        this.selectId = this.mounttype[0].Id
        let sessSelectId = window.sessionStorage.getItem('userPaySelectId')
        let id = window.sessionStorage.getItem('thisId')
        if(this.$route.query.id == id){
          this.selectId = sessSelectId
          let name = this.mounttype.filter(item=>{
            if (item.Id == sessSelectId){
              return item
            }
          })
          this.$emit("typeset", name[0].Name)//默认选中两元
        }
      }
    }
  }
</script>
<style lang="scss" scoped>
    /* 用户投注 */
    .user_pay {
        padding: 0 0 18px;

        .quick_content_box3 {
            display: flex;
            justify-content: space-between;
            width: 100%;
            padding: 25px 20px 0;

            .quick_user_opration {
                padding-top: 7px;
                font-size: 14px;

                .quick_user_inputbox {
                    color: #575757;

                    .quick_user_input1 {
                        font-size: 14px;
                        justify-content: center;
                        align-items: center;
                        margin-right: 10px;

                        .comput_flod{
                            display: flex;
                            justify-content:space-between;
                            white-space: nowrap;
                            width: 90px;
                            height: 30px;
                            font-size: 0;
                            border: 1px solid #C6D1D0;
                            border-left: 0;
                            border-right: 0;
                            border-radius: 3px;
                            overflow: hidden;

                            button {
                                display: flex;
                                justify-content: center;
                                align-items: center;
                                width: 30px;
                                height: 30px;
                                outline: none;
                                font-size: 28px;
                                cursor: pointer;
                                border: 1px solid #C6D1D0;
                                border-radius:3px;
                                margin-top: -1px;
                                font-weight: lighter;
                                font-family:宋体;
                                background: none;
                            }

                            div {
                                position: relative;
                                width: 28px;
                                height: 30px;
                                line-height: 30px;
                                font-size: 0px;
                                text-align: center;
                                box-sizing: border-box;

                                input {
                                    font-size: 14px;
                                    border: none;
                                    outline: none;
                                    width: 28px;
                                    height: 28px;
                                    line-height: 30px;
                                    text-align: center;
                                    font-family:"Microsoft YaHei", 微软雅黑;
                                    background: none;
                                }
                            }

                            .quick_add {
                                margin-left: -1px;
                            }


                            .quick_reduce {
                                margin-right: -1px;
                            }
                        }

                        .arrow_bottom_box {
                            width: 50px;
                            position: absolute;
                            background: #fff;
                            top: 30px;
                            left: -7px;
                            z-index: 666;
                            border: 1px solid #eaeaea;
                            height: 112px;

                            span {
                                display: block;
                                text-align: center;
                                line-height: 22px;
                                color: #000;
                                font-size: 14px;
                                cursor: pointer;

                                &:hover {
                                    background: #1f7877;
                                    color: white;
                                }
                            }
                        }

                        strong{
                          font-weight: normal;
                          color: #FE6D60;
                        }
                    }

                    .quick_user_input2{
                        display: flex;
                        justify-content: center;
                        align-items: center;
                        overflow: hidden;

                        div {
                            width: 36px;
                            height: 30px;
                            line-height: 30px;
                            text-align: center;
                            margin: 0 4px;
                            font-size: 14px;
                            border-radius: 3px;
                            border: 1px solid #C6D1D0;
                            cursor: pointer;

                            &.selected {
                                color: #ffffff !important;
                                background-color: #008573 !important;
                                border:none;
                            }
                            select{

                                &:focus{
                                    outline: none;
                                }
                            }
                        }
                    }
                    .quick_user_input1,.quick_user_input2{

                        span{
                            font-size: 14px;
                            vertical-align: middle;
                            margin-right: 10px;
                        }
                        
                    }
                }
            }

            .user_btn_box{
                display: flex;
                justify-content: space-between;
                width:250px;

                a{
                    width: 120px;
                    height: 40px;
                    line-height: 40px;
                    border-radius: 20px;
                    font-size: 16px;

                    &.add_num{
                        color: #666;
                        border: 1px solid #C6D1D0;
                        background: linear-gradient(0deg, #F8F8F8, #FFFFFF);
                    }

                    &.direct_bet{
                        background: linear-gradient(90deg, #D3B47E, #C19F62);
                    }

                    &:first-child{
                      margin-right: 0;
                    }
                }
            }
        }
    }
</style>
